---

- name: include os-specific variables
  include_vars: "{{ item }}" 
  loop:
    - main.yml
    - "{{ ansible_os_family }}.yml"

- name: install dependencies
  package:
    name: "{{ item }}"
    state: present
  loop: "{{ deps }}"

- name: check if docker is installed
  shell: which docker
  register: docker_installed
  changed_when: False
  failed_when: False

- name: install docker
  shell: curl -fsSL get.docker.com | sh
  args:
    executable: /bin/bash
  when: docker_installed.rc != 0

- name: make sure the docker config directory exists
  file:
    path: /etc/docker/
    state: directory

- name: configure the docker daemon
  template:
    src: docker.daemon.json.j2
    dest: /etc/docker/daemon.json
    mode: '0644'
  notify: enable/restart docker

- name: enable the docker daemon
  service:
    name: docker
    enabled: yes
    state: started

